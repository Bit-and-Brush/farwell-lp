---
import { getPageDataWithLayoutData } from "@/api";
import type { GetFacilitiesPageDataResponse } from "@/api/type";
import PageHero from "@/components/common/page-hero.astro";
import FeaturesSection from "@/components/sections/facilities/features-section.astro";
import MainLayout from "@/layouts/main-layout.astro";
import { Image } from "astro:assets";

const [facilitiesData, headerData, footerData] =
  await getPageDataWithLayoutData<GetFacilitiesPageDataResponse>("facilities");
const { areaClient, catalogFile } = headerData;
const { services, description, contact } = footerData;
const { facilitiesSection, header } = facilitiesData;
---

<MainLayout
  extendedTitle={header.title}
  footer={{
    services: services.map(({ title }) => title),
    description,
    contacts:
      contact.map(({ fields: { value, icon } }) => ({ value, icon })) ?? [],
  }}
  headerLinks={{ catalog: catalogFile, clientArea: areaClient }}
>
  <main>
    <PageHero title={header.title} subtitle={header.description} />
    <div class="container mt-10">
      {
        header.image && (
          <Image
            src={header.image}
            alt={header.title}
            width={854}
            height={480}
            loading="eager"
            fetchpriority="high"
            class="mx-auto max-h-[480px] max-w-[854px] rounded-xl object-cover object-center"
          />
        )
      }
    </div>
    <FeaturesSection facilities={facilitiesSection.facilities ?? []} />
    {
      facilitiesSection.capabilities &&
        facilitiesSection.capabilities.length > 0 && (
          <section class="container mt-10 mb-12 space-y-4">
            <h2 class="text-secondary text-xl font-bold">Capacidades</h2>
            <ul class="grid grid-cols-1 gap-2 lg:grid-cols-2">
              {facilitiesSection.capabilities.map(({ text }) => (
                <li class="text-sm">{text}</li>
              ))}
            </ul>
          </section>
        )
    }
  </main>
</MainLayout>
