---
import { getPageDataWithLayoutData } from "@/api";
import type { GetProductPageDataResponse } from "@/api/type";
import PageHero from "@/components/common/page-hero.astro";
import ProductsSection from "@/components/sections/products/products-section.astro";
import QualityAssuranceSection from "@/components/sections/products/quality-assurance-section.astro";
import MainLayout from "@/layouts/main-layout.astro";

const [productsPageData, headerData, footerData] =
  await getPageDataWithLayoutData<GetProductPageDataResponse>("products");
const { areaClient, catalogFile } = headerData;
const { services, description, contact } = footerData;
const { header, qualityAssurance, products } = productsPageData;
---

<MainLayout
  extendedTitle="Os Nossos Produtos"
  footer={{
    services: services.map(({ title }) => title),
    description,
    contacts:
      contact.map(({ fields: { value, icon } }) => ({ value, icon })) ?? [],
  }}
  headerLinks={{ catalog: catalogFile, clientArea: areaClient }}
>
  <main>
    <PageHero title={header.title} subtitle={header.description} />
    {
      products && products.length > 0 && (
        <ProductsSection
          products={products.map(
            ({ fields: { bulletPoints, description, icon }, title }) => ({
              title,
              bulletPoints:
                bulletPoints.map(({ description }) => description) ?? [],
              description,
              icon,
            })
          )}
        />
      )
    }
    {
      qualityAssurance && (
        <QualityAssuranceSection
          title={qualityAssurance.title}
          description={qualityAssurance.description}
          keyPoints={qualityAssurance.keyPoints.map(({ icon, ...rest }) => ({
            iconUrl: icon,
            ...rest,
          }))}
        />
      )
    }
  </main>
</MainLayout>
