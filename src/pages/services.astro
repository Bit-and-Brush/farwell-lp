---
import { getPageDataWithLayoutData } from "@/api";
import type { GetServicesPageDataResponse } from "@/api/type";
import PageHero from "@/components/common/page-hero.astro";
import GetStartedSection from "@/components/sections/services/get-started-section.astro";
import ServicesSection from "@/components/sections/services/services-section.astro";
import WhyOurServicesSection from "@/components/sections/services/why-our-services-section.astro";
import MainLayout from "@/layouts/main-layout.astro";

const [servicesData, headerData, footerData] =
  await getPageDataWithLayoutData<GetServicesPageDataResponse>("services");
const { areaClient, catalogFile } = headerData;
const { services, description } = footerData;
const { contact, header, ourServices, whyChooseOurServices } = servicesData;
---

<MainLayout
  extendedTitle="Os Nossos ServiÃ§os"
  footer={{
    services: services.map(({ title }) => title),
    description,
    // contacts: contact.map(({ fields: { value } }) => value) ?? [],
  }}
  headerLinks={{ catalog: catalogFile, clientArea: areaClient }}
>
  <main>
    <PageHero title={header.title} subtitle={header.description} />
    {
      ourServices && (
        <ServicesSection
          services={ourServices.map(
            ({
              fields: { bulletPoints, description, icon, keyMetrics },
              title,
            }) => ({
              bulletPoints: bulletPoints.map(({ description }) => description),
              description,
              keyMetrics: keyMetrics.map(({ description, title }) => ({
                description,
                title,
              })),
              title,
              iconUrl: icon,
            })
          )}
        />
      )
    }
    {
      whyChooseOurServices && (
        <WhyOurServicesSection
          title={whyChooseOurServices.title}
          description={whyChooseOurServices.description}
          keyPoints={whyChooseOurServices.keyPoints}
        />
      )
    }
    {
      contact && (
        <GetStartedSection
          title={contact.title}
          description={contact.description}
          contacts={contact.contacts}
        />
      )
    }
  </main>
</MainLayout>
